"use strict";(self.webpackChunkmusory=self.webpackChunkmusory||[]).push([[229],{4617:function(e,n,r){r.r(n),r.d(n,{default:function(){return k}});var t=r(9439),a=r(2791),i=r(9126),o=r(3183),c=r(184);var l=function(e){var n=(0,a.useRef)(null);return(0,a.useEffect)((function(){var r,t=null===(r=n.current)||void 0===r?void 0:r.getContext("2d");if(e.analyzer){var a=e.samplingStep;(!a||a<0)&&(a=1),function(e,n,r){var t=e.canvas.height,a=e.canvas.width;e.lineWidth=1,e.strokeStyle="rgb(0, 0, 0)";var i=n.fftSize,o=new Uint8Array(i),c=a/i;!function a(){e.clearRect(0,0,e.canvas.width,e.canvas.height),requestAnimationFrame(a),n.getByteTimeDomainData(o),e.beginPath();for(var l=0,s=0;s<i;s+=r){var u=o[s]/128*t/2;0===s?e.moveTo(l,u):e.lineTo(l,u),l+=c*r}e.lineTo(e.canvas.width,e.canvas.height/2),e.stroke()}()}(t,e.analyzer,a)}})),(0,c.jsx)("div",{className:"border h-40 w-full",children:(0,c.jsx)("canvas",{ref:n,className:"w-full h-full min-h-full"})})},s=r(8320),u=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],f={fromFrequency:function(e){var n=Math.log(e/440)/Math.log(2)*12,r=Math.round(n)+60,t=u[r%u.length],a=Math.ceil(r/12)-1;return"A#"!=t&&"B"!=t||a--,"".concat(t).concat(a)},ClefBass:"bass",ClefTreble:"treble",preferredClef:function(e){var n=s.jC.octave(e);return!n||n>=4?f.ClefTreble:f.ClefBass}},d=f,m=r(763);function v(e,n,r,t){var a="",i=-100,o=0,c=5,l=0,u=new Float32Array(e.fftSize);!function f(){if(n&&r&&n.current&&r.current){requestAnimationFrame(f),e.getFloatTimeDomainData(u);var m=function(e,n){for(var r=e.length,t=0,a=0;a<r;a++){var i=e[a];t+=i*i}if(Math.sqrt(t/r)<.01)return-1;for(var o=0,c=r-1,l=0;l<r/2;l++)if(Math.abs(e[l])<.2){o=l;break}for(var s=1;s<r/2;s++)if(Math.abs(e[r-s])<.2){c=r-s;break}r=(e=e.slice(o,c)).length;for(var u=new Array(r).fill(0),f=0;f<r;f++)for(var d=0;d<r-f;d++)u[f]=u[f]+e[d]*e[d+f];for(var m=0;u[m]>u[m+1];)m++;for(var v=-1,h=-1,x=m;x<r;x++)u[x]>v&&(v=u[x],h=x);var y=h,b=u[y-1],j=u[y],w=u[y+1],g=(b+w-2*j)/2;return g&&(y-=(w-b)/2/(2*g)),n/y}(u,e.context.sampleRate);if(!(Number.isNaN(m)||m<0)){if(!(Math.abs(m-i)<c)){i=m,a=d.fromFrequency(m);var v=s.jC.get(a),h=s.jC.fromMidi(v.midi-3);return c=v.freq-s.jC.midi(h),o=0,void(l=0)}if(o<8)o++;else{i=m,o=0,a=d.fromFrequency(m),n.current.innerText=a,r.current.innerText="".concat(m.toFixed(2)," Hz");var x=(new Date).getTime();x-l>=500&&(null===t||void 0===t||t(a),l=x)}}}}()}var h,x=function(e){var n=(0,a.useRef)(null),r=(0,a.useRef)(null);return(0,a.useEffect)((function(){if(e.analyzer){var t=(0,m.throttle)((function(n){var r;null===(r=e.onNoteDetected)||void 0===r||r.call(e,n)}),150);v(e.analyzer,n,r,t)}})),(0,c.jsxs)("div",{className:"font-bold text-center "+(e.analyzer?"":"text-gray-400"),children:[(0,c.jsx)("p",{ref:n,className:"text-6xl",children:"--"}),(0,c.jsx)("p",{ref:r,className:"text-sl",children:"-- Hz"})]})},y=r(3398),b=function(e){var n=(0,a.useRef)(null),r=e.scale?e.scale:1;return(0,a.useEffect)((function(){if(n&&n.current){var t=function(e){return e.clef?e.clef:e.name?d.preferredClef(e.name):d.ClefTreble}(e),a=n.current,i=function(){a.childNodes.forEach((function(e){return a.removeChild(e)}))};i();var o=function(e,n){var t=window.getComputedStyle(e),a=Number.parseInt(t.width),i=150*r,o=new y.Th(e,y.Th.Backends.SVG);o.resize(a,i);var c=o.getContext();c.scale(r,r);var l=new y.D8(10,0,a/r-20);return l.addClef(n),l.setContext(c).draw(),l}(a,t);if(!e.name)return i;var c=new y.ZV;c.setMode(y.ZV.Mode.FULL);var l=s.jC.get(e.name),u=new y.$6({keys:["".concat(l.letter).concat(l.acc?l.acc:"","/").concat(l.oct)],duration:"q",clef:t,auto_stem:!0,align_center:!0}),f=70;l.acc&&(u.addModifier(new y.rT(l.acc)),f=50),c.addTickable(u);var m=o.getWidth()-f;return(new y.Mb).joinVoices([c]).format([c],m),c.draw(o.getContext(),o),i}}),[n,e.name]),(0,c.jsx)("div",{ref:n,className:"w-full"})},j=r(3628),w=r(4282),g=(r(6049),r(8627)),N=r(8819),p=r(8014);!function(e){e[e.Sound=0]="Sound",e[e.Keyboard=1]="Keyboard"}(h||(h={}));var C=function(e,n){var r=s.jC.midi(e),t=s.jC.midi(n);if(!r||!t)return"A4";var a=r+Math.floor(Math.random()*(t-r));return s.jC.fromMidi(a).replaceAll("b","").replaceAll("#","")},k=function(){var e=(0,a.useState)(h.Keyboard),n=(0,t.Z)(e,2),r=n[0],u=n[1],f=(0,a.useState)(!1),d=(0,t.Z)(f,2),m=d[0],v=d[1],y=(0,a.useState)("C4"),k=(0,t.Z)(y,2),S=k[0],M=k[1],T=(0,a.useState)("C5"),z=(0,t.Z)(T,2),D=z[0],A=z[1],F=(0,a.useState)(C(S,D)),q=(0,t.Z)(F,2),Z=q[0],R=q[1],B=(0,a.useState)(),E=(0,t.Z)(B,2),V=E[0],K=E[1];function L(){var e,n;null===V||void 0===V||null===(e=V.analyzer)||void 0===e||e.disconnect(),null===V||void 0===V||null===(n=V.stream)||void 0===n||n.getTracks().forEach((function(e){return e.stop()})),K({stream:void 0,analyzer:void 0})}function G(e){var n=!1;if(r==h.Sound){var t=s.jC.midi(Z);s.jC.midi(e)==t&&(n=!0)}else n=e[0].toLowerCase()==Z[0].toLowerCase();n&&(console.log(e,Z,n),R(C(S,D)))}return(0,o.y1)("Space",(function(){return v((function(e){return!e}))})),(0,a.useEffect)((function(){if(m)return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){var n=new window.AudioContext,r=new AnalyserNode(n,{minDecibels:-70,maxDecibels:-20});n.createMediaStreamSource(e).connect(r),K({stream:e,analyzer:r})})),L;L()}),[m]),(0,c.jsxs)("div",{className:"m-auto flex flex-col items-center",children:[(0,c.jsxs)("div",{className:"flex flex-row w-full mb-12",children:[(0,c.jsxs)("div",{className:"flex flex-row flex-wrap items-center basis-1/2 justify-center space-x-2",children:[(0,c.jsx)("p",{className:"",children:"Lowest note"}),(0,c.jsx)(j.DebounceInput,{value:S,debounceTimeout:500,onChange:function(e){return M(e.target.value)},className:"border border-cyan-500 w-12 text-center"}),(0,c.jsx)(b,{name:S})]}),(0,c.jsxs)("div",{className:"flex flex-wrap flex-row items-center basis-1/2 justify-center space-x-2",children:[(0,c.jsx)("p",{children:"Highest note"}),(0,c.jsx)(j.DebounceInput,{value:D,debounceTimeout:500,onChange:function(e){return A(e.target.value)},className:"border border-cyan-500 w-12 text-center"}),(0,c.jsx)(b,{name:D})]})]}),(0,c.jsx)(b,{name:Z,scale:3}),(0,c.jsxs)("div",{className:"flex flex-row flex-nowrap w-full",children:[(0,c.jsx)("div",{className:"basic-1/2 h-full ".concat(r==h.Keyboard?"text-cyan-500":""),onClick:function(){return u(h.Keyboard)},children:(0,c.jsx)(N.Z,{name:"Virtual keyboard",description:"Name the key with virtual keyboard, can type the key using laptop keyboard",icon:(0,c.jsx)(p.sMA,{})})}),(0,c.jsx)("div",{className:"basic-1/2 h-full ".concat(r==h.Sound?"text-cyan-500":""),onClick:function(){return u(h.Sound)},children:(0,c.jsx)(N.Z,{name:"Pitch detection",description:"Using microphone to detect note name from sound. WARNING: slow and not very correct!",icon:(0,c.jsx)(p._5g,{})})})]}),function(e){if(e==h.Sound)return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{id:"btn-play",className:"text-6xl "+(m?"":"text-gray-400")+" hover:text-cyan-500",onMouseDown:function(){return v((function(e){return!e}))},children:m?(0,c.jsx)(i.C4C,{}):(0,c.jsx)(i.OnQ,{})}),(0,c.jsx)(l,{analyzer:null===V||void 0===V?void 0:V.analyzer,samplingStep:10}),(0,c.jsx)(x,{analyzer:null===V||void 0===V?void 0:V.analyzer,onNoteDetected:G}),(0,c.jsx)("article",{className:"prose",children:(0,c.jsx)("ul",{children:(0,c.jsxs)("li",{children:["Press ",(0,c.jsx)("kbd",{children:"Space"})," to toggle pitch detection via microphone."]})})})]});var n=w.qM.fromNote("C4"),r=w.qM.fromNote("B4"),t=(new g.WV).toDestination();return(0,c.jsxs)("div",{className:"w-full h-64",children:[(0,c.jsx)(w.id,{noteRange:{first:n,last:r},keyboardShortcuts:[{key:"c",midiNumber:60},{key:"d",midiNumber:62},{key:"e",midiNumber:64},{key:"f",midiNumber:65},{key:"g",midiNumber:67},{key:"a",midiNumber:69},{key:"b",midiNumber:71}],playNote:function(e){var n=s.jC.fromMidi(e);t.triggerAttackRelease(n,.05),G(n)},stopNote:function(){}}),(0,c.jsx)("div",{className:"flex flex-col items-center",children:(0,c.jsx)("article",{className:"prose",children:(0,c.jsx)("ul",{children:(0,c.jsx)("li",{children:"Press the letter to name the note"})})})})]})}(r)]})}}}]);
//# sourceMappingURL=229.42729533.chunk.js.map