{"version":3,"file":"static/js/977.8291e874.chunk.js","mappings":"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","sources":["pages/Metronome.tsx"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { useHotkeys } from 'react-hotkeys-hook'\nimport { DebounceInput } from 'react-debounce-input'\nimport { GiPauseButton, GiPlayButton } from 'react-icons/gi'\nimport { Loop, start as toneStart, Synth, Transport } from 'tone'\n\nclass timeSignature {\n  str: string\n  beats: number // how many beat per measure\n  note: number // what kind of note per beat\n  constructor(sign: string) {\n    this.str = sign\n    const ss = sign.split('/')\n    if (ss.length != 2) {\n      this.beats = 0\n      this.note = 0\n      return\n    }\n    this.beats = Number.parseInt(ss[0])\n    this.note = Number.parseInt(ss[1])\n  }\n}\n\nconst timeSignatures: timeSignature[] = ['2/2', '2/4', '3/4', '4/4'].map(\n  (s) => new timeSignature(s)\n)\n\nconst TimeSignature = (p: {\n  active: boolean\n  sign: timeSignature\n  onClick: (str: string) => void\n}) => {\n  let cls =\n    'flex border m-2 p-2 flex-col items-center text-center text-xl font-bold ' +\n    'border-2 hover:border-cyan-500'\n  if (p.active) {\n    cls += ' border-cyan-700'\n  }\n\n  return (\n    <button className={cls} onClick={() => p.onClick(p.sign.str)}>\n      <p>{p.sign.beats}</p>\n      <p>{p.sign.note}</p>\n    </button>\n  )\n}\n\nconst defaultBMP = 100\nconst minBMP = 10\nconst maxBMP = 400\nconst safeBmp = (pre: number, n: number) => {\n  if (Number.isNaN(n)) {\n    return pre\n  }\n\n  if (n < minBMP) {\n    return minBMP\n  }\n\n  if (n > maxBMP) {\n    return maxBMP\n  }\n\n  return n\n}\n\nlet toneLoop: Loop\n\nfunction togglePlaying(playing: boolean, bpm: number, sign: string) {\n  if (toneLoop) {\n    toneLoop.stop(0)\n  }\n\n  if (!playing) {\n    return\n  }\n\n  const timeSign = new timeSignature(sign)\n\n  const synth = new Synth().toDestination()\n  let count = 0\n  toneLoop = new Loop((time) => {\n    if (sign != '' && count % timeSign.beats == 0) {\n      synth.triggerAttackRelease('B2', 0.01, time)\n    } else {\n      synth.triggerAttackRelease('G2', 0.01, time)\n    }\n    count++\n  }).start(0)\n  Transport.bpm.rampTo(bpm)\n  Transport.start()\n}\n\nconst Metronome = () => {\n  const [bmp, setBmp] = useState(defaultBMP)\n  const [playing, setPlaying] = useState(false)\n  const [signature, setSignature] = useState('')\n\n  useHotkeys('up', () => setBmp((pre) => safeBmp(pre, pre + 1)))\n  useHotkeys('k', () => setBmp((pre) => safeBmp(pre, pre + 1)))\n  useHotkeys('down', () => setBmp((pre) => safeBmp(pre, pre - 1)))\n  useHotkeys('j', () => setBmp((pre) => safeBmp(pre, pre - 1)))\n\n  useHotkeys('Enter', () => {\n    toneStart().then(() => setPlaying((pre) => !pre))\n  })\n  useHotkeys('Space', () => {\n    toneStart().then(() => setPlaying((pre) => !pre))\n  })\n\n  useEffect(() => {\n    togglePlaying(playing, bmp, signature)\n    return () => togglePlaying(false, bmp, signature)\n  })\n\n  return (\n    <div className=\"m-auto flex flex-col center items-center\">\n      <DebounceInput\n        type=\"number\"\n        pattern=\"\\d*\"\n        debounceTimeout={200}\n        value={bmp}\n        onChange={(e) =>\n          setBmp((pre) => safeBmp(pre, Number.parseInt(e.target.value)))\n        }\n        className=\"text-6xl m-auto w-1/2 text-center outline-none appearance-none\"\n      />\n      <p className=\"text-sl\">BMP</p>\n\n      <button\n        autoFocus\n        id=\"btn-play\"\n        className=\"text-6xl cursor-pointer\"\n        onClick={(e) => {\n          if (e.clientX && e.clientY) {\n            toneStart().then(() => setPlaying(!playing))\n          }\n        }}\n      >\n        {playing ? <GiPauseButton /> : <GiPlayButton />}\n      </button>\n\n      <div className=\"flex flex-row\">\n        {timeSignatures.map((sign) => {\n          const active = signature != '' && signature == sign.str\n          return (\n            <TimeSignature\n              active={active}\n              key={sign.str}\n              sign={sign}\n              onClick={setSignature}\n            />\n          )\n        })}\n      </div>\n\n      <article className=\"prose\">\n        <ul>\n          <li>Click the BPM number to edit it directly</li>\n          <li>\n            <kbd>Up</kbd> or <kbd>j</kbd> to increase the BMP.\n          </li>\n          <li>\n            <kbd>Down</kbd> or <kbd>k</kbd> to increase the BMP.\n          </li>\n          <li>\n            <kbd>Enter</kbd> or <kbd>Space</kbd> to toggle playing.\n          </li>\n          <li>\n            Hit <kbd>Tab</kbd> or click outside of BMP input if can't toggle\n            playing using shortcuts\n          </li>\n        </ul>\n      </article>\n    </div>\n  )\n}\n\nexport default Metronome\n"],"names":["toneLoop","timeSignature","sign","str","beats","note","this","ss","split","length","Number","parseInt","timeSignatures","map","s","TimeSignature","p","cls","active","className","onClick","safeBmp","pre","n","isNaN","togglePlaying","playing","bpm","stop","timeSign","synth","Synth","toDestination","count","Loop","time","triggerAttackRelease","start","Transport","useState","bmp","setBmp","setPlaying","signature","setSignature","useHotkeys","toneStart","then","useEffect","DebounceInput","type","pattern","debounceTimeout","value","onChange","e","target","autoFocus","id","clientX","clientY"],"sourceRoot":""}