"use strict";(self.webpackChunkmusory=self.webpackChunkmusory||[]).push([[617],{4617:function(e,n,r){r.r(n),r.d(n,{default:function(){return g}});var t=r(9439),a=r(2791),i=r(9126),c=r(3183),l=r(184);var o=function(e){var n=(0,a.useRef)(null);return(0,a.useEffect)((function(){var r,t=null===(r=n.current)||void 0===r?void 0:r.getContext("2d");if(e.analyzer){var a=e.samplingStep;(!a||a<0)&&(a=1),function(e,n,r){var t=e.canvas.height,a=e.canvas.width;e.lineWidth=1,e.strokeStyle="rgb(0, 0, 0)";var i=n.fftSize,c=new Uint8Array(i),l=a/i;!function a(){e.clearRect(0,0,e.canvas.width,e.canvas.height),requestAnimationFrame(a),n.getByteTimeDomainData(c),e.beginPath();for(var o=0,s=0;s<i;s+=r){var u=c[s]/128*t/2;0===s?e.moveTo(o,u):e.lineTo(o,u),o+=l*r}e.lineTo(e.canvas.width,e.canvas.height/2),e.stroke()}()}(t,e.analyzer,a)}})),(0,l.jsx)("div",{className:"border h-40 w-full",children:(0,l.jsx)("canvas",{ref:n,className:"w-full h-full min-h-full"})})},s=r(8320),u=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],f={fromFrequency:function(e){var n=Math.log(e/440)/Math.log(2)*12,r=Math.round(n)+60,t=u[r%u.length],a=Math.ceil(r/12)-1;return"A#"!=t&&"B"!=t||a--,"".concat(t).concat(a)},ClefBass:"bass",ClefTreble:"treble",preferredClef:function(e){var n=s.jC.octave(e);return!n||n>=4?f.ClefTreble:f.ClefBass}},d=f,v=r(763);function m(e,n,r,t){var a="",i=-100,c=0,l=5,o=0,u=new Float32Array(e.fftSize);!function f(){if(n&&r&&n.current&&r.current){requestAnimationFrame(f),e.getFloatTimeDomainData(u);var v=function(e,n){for(var r=e.length,t=0,a=0;a<r;a++){var i=e[a];t+=i*i}if(Math.sqrt(t/r)<.01)return-1;for(var c=0,l=r-1,o=0;o<r/2;o++)if(Math.abs(e[o])<.2){c=o;break}for(var s=1;s<r/2;s++)if(Math.abs(e[r-s])<.2){l=r-s;break}r=(e=e.slice(c,l)).length;for(var u=new Array(r).fill(0),f=0;f<r;f++)for(var d=0;d<r-f;d++)u[f]=u[f]+e[d]*e[d+f];for(var v=0;u[v]>u[v+1];)v++;for(var m=-1,h=-1,x=v;x<r;x++)u[x]>m&&(m=u[x],h=x);var j=h,b=u[j-1],w=u[j],g=u[j+1],C=(b+g-2*w)/2;return C&&(j-=(g-b)/2/(2*C)),n/j}(u,e.context.sampleRate);if(!(Number.isNaN(v)||v<0)){if(!(Math.abs(v-i)<l)){i=v,a=d.fromFrequency(v);var m=s.jC.get(a),h=s.jC.fromMidi(m.midi-3);return l=m.freq-s.jC.midi(h),c=0,void(o=0)}if(c<8)c++;else{i=v,c=0,a=d.fromFrequency(v),n.current.innerText=a,r.current.innerText="".concat(v.toFixed(2)," Hz");var x=(new Date).getTime();x-o>=500&&(null===t||void 0===t||t(a),o=x)}}}}()}var h=function(e){var n=(0,a.useRef)(null),r=(0,a.useRef)(null);return(0,a.useEffect)((function(){if(e.analyzer){var t=(0,v.throttle)((function(n){var r;null===(r=e.onNoteDetected)||void 0===r||r.call(e,n)}),150);m(e.analyzer,n,r,t)}})),(0,l.jsxs)("div",{className:"font-bold text-center "+(e.analyzer?"":"text-gray-400"),children:[(0,l.jsx)("p",{ref:n,className:"text-6xl",children:"--"}),(0,l.jsx)("p",{ref:r,className:"text-sl",children:"-- Hz"})]})},x=r(3398),j=function(e){var n=(0,a.useRef)(null),r=e.scale?e.scale:1;return(0,a.useEffect)((function(){if(n&&n.current){var t=function(e){return e.clef?e.clef:e.name?d.preferredClef(e.name):d.ClefTreble}(e),a=n.current,i=function(){a.childNodes.forEach((function(e){return a.removeChild(e)}))};i();var c=function(e,n){var t=window.getComputedStyle(e),a=Number.parseInt(t.width),i=150*r,c=new x.Th(e,x.Th.Backends.SVG);c.resize(a,i);var l=c.getContext();l.scale(r,r);var o=new x.D8(10,0,a/r-20);return o.addClef(n),o.setContext(l).draw(),o}(a,t);if(!e.name)return i;var l=new x.ZV;l.setMode(x.ZV.Mode.FULL);var o=s.jC.get(e.name),u=new x.$6({keys:["".concat(o.letter).concat(o.acc?o.acc:"","/").concat(o.oct)],duration:"q",clef:t,auto_stem:!0,align_center:!0}),f=70;o.acc&&(u.addModifier(new x.rT(o.acc)),f=50),l.addTickable(u);var v=c.getWidth()-f;return(new x.Mb).joinVoices([l]).format([l],v),l.draw(c.getContext(),c),i}}),[n,e.name]),(0,l.jsx)("div",{ref:n,className:"w-full"})},b=r(3628),w=function(e,n){var r=s.jC.midi(e),t=s.jC.midi(n);if(!r||!t)return"A4";var a=r+Math.floor(Math.random()*(t-r));return s.jC.fromMidi(a).replaceAll("b","").replaceAll("#","")},g=function(){var e=(0,a.useState)(!1),n=(0,t.Z)(e,2),r=n[0],u=n[1],f=(0,a.useState)("C4"),d=(0,t.Z)(f,2),v=d[0],m=d[1],x=(0,a.useState)("C5"),g=(0,t.Z)(x,2),C=g[0],y=g[1],p=(0,a.useState)(w(v,C)),N=(0,t.Z)(p,2),M=N[0],T=N[1],z=(0,a.useState)(),D=(0,t.Z)(z,2),S=D[0],k=D[1];function A(){var e,n;null===S||void 0===S||null===(e=S.analyzer)||void 0===e||e.disconnect(),null===S||void 0===S||null===(n=S.stream)||void 0===n||n.getTracks().forEach((function(e){return e.stop()})),k({stream:void 0,analyzer:void 0})}return(0,c.y1)("Space",(function(){return u((function(e){return!e}))})),(0,a.useEffect)((function(){if(r)return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){var n=new window.AudioContext,r=new AnalyserNode(n,{minDecibels:-70,maxDecibels:-20});n.createMediaStreamSource(e).connect(r),k({stream:e,analyzer:r})})),A;A()}),[r]),(0,l.jsxs)("div",{className:"m-auto flex flex-col items-center",children:[(0,l.jsxs)("div",{className:"flex flex-row w-full mb-12",children:[(0,l.jsxs)("div",{className:"flex flex-row flex-wrap items-center basis-1/2 justify-center space-x-2",children:[(0,l.jsx)("p",{className:"",children:"Lowest note"}),(0,l.jsx)(b.DebounceInput,{value:v,debounceTimeout:500,onChange:function(e){return m(e.target.value)},className:"border border-cyan-500 w-12 text-center"}),(0,l.jsx)(j,{name:v})]}),(0,l.jsxs)("div",{className:"flex flex-wrap flex-row items-center basis-1/2 justify-center space-x-2",children:[(0,l.jsx)("p",{children:"Highest note"}),(0,l.jsx)(b.DebounceInput,{value:C,debounceTimeout:500,onChange:function(e){return y(e.target.value)},className:"border border-cyan-500 w-12 text-center"}),(0,l.jsx)(j,{name:C})]})]}),(0,l.jsx)(j,{name:M,scale:3}),(0,l.jsx)("button",{id:"btn-play",className:"text-6xl "+(r?"":"text-gray-400")+" hover:text-cyan-500",onMouseDown:function(){return u((function(e){return!e}))},children:r?(0,l.jsx)(i.C4C,{}):(0,l.jsx)(i.OnQ,{})}),(0,l.jsx)(o,{analyzer:null===S||void 0===S?void 0:S.analyzer,samplingStep:10}),(0,l.jsx)(h,{analyzer:null===S||void 0===S?void 0:S.analyzer,onNoteDetected:function(e){var n=s.jC.midi(M);s.jC.midi(e)==n&&T(w(v,C))}}),(0,l.jsx)("article",{className:"prose",children:(0,l.jsx)("ul",{children:(0,l.jsxs)("li",{children:["Press ",(0,l.jsx)("kbd",{children:"Space"})," to toggle pitch detection via microphone."]})})})]})}}}]);
//# sourceMappingURL=617.28b1145f.chunk.js.map