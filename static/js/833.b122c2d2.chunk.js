"use strict";(self.webpackChunkmusory=self.webpackChunkmusory||[]).push([[833],{833:function(e,n,r){r.r(n),r.d(n,{default:function(){return d}});var a=r(885),t=r(791),i=r(126),l=r(183),o=r(184);var c=function(e){var n=(0,t.useRef)(null);return(0,t.useEffect)((function(){var r,a=null===(r=n.current)||void 0===r?void 0:r.getContext("2d");if(e.analyzer){var t=e.samplingStep;(!t||t<0)&&(t=1),function(e,n,r){var a=e.canvas.height,t=e.canvas.width;e.lineWidth=1,e.strokeStyle="rgb(0, 0, 0)",function i(){e.clearRect(0,0,e.canvas.width,e.canvas.height),requestAnimationFrame(i);var l=n.fftSize,o=new Uint8Array(l);n.getByteTimeDomainData(o),e.beginPath();for(var c=t/l,s=0,u=0;u<l;u+=r){var f=o[u]/128*a/2;0===u?e.moveTo(s,f):e.lineTo(s,f),s+=c*r}e.lineTo(e.canvas.width,e.canvas.height/2),e.stroke()}()}(a,e.analyzer,t)}})),(0,o.jsx)("div",{className:"border h-40 w-full",children:(0,o.jsx)("canvas",{ref:n,className:"w-full h-full min-h-full"})})},s=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],u={fromFrequency:function(e){var n=Math.log(e/440)/Math.log(2)*12,r=Math.round(n)+60,a=s[r%s.length],t=Math.ceil(r/12)-1;return"A#"!=a&&"B"!=a||t--,"".concat(a).concat(t)}};function f(e,n,r){!function a(){if(requestAnimationFrame(a),n&&r&&n.current&&r.current){var t=new Float32Array(e.fftSize);e.getFloatTimeDomainData(t);var i=function(e,n){for(var r=e.length,a=0,t=0;t<r;t++){var i=e[t];a+=i*i}if(Math.sqrt(a/r)<.01)return-1;for(var l=0,o=r-1,c=0;c<r/2;c++)if(Math.abs(e[c])<.2){l=c;break}for(var s=1;s<r/2;s++)if(Math.abs(e[r-s])<.2){o=r-s;break}r=(e=e.slice(l,o)).length;for(var u=new Array(r).fill(0),f=0;f<r;f++)for(var v=0;v<r-f;v++)u[f]=u[f]+e[v]*e[v+f];for(var d=0;u[d]>u[d+1];)d++;for(var h=-1,m=-1,x=d;x<r;x++)u[x]>h&&(h=u[x],m=x);var y=m,g=u[y-1],p=u[y],z=u[y+1],j=(g+z-2*p)/2;return j&&(y-=(z-g)/2/(2*j)),n/y}(t,e.context.sampleRate);Number.isNaN(i)||i<0||(n.current.innerText=u.fromFrequency(i),r.current.innerText="".concat(i.toFixed(2)," Hz"))}}()}var v=function(e){var n=(0,t.useRef)(null),r=(0,t.useRef)(null);return(0,t.useEffect)((function(){e.analyzer&&f(e.analyzer,n,r)})),(0,o.jsxs)("div",{className:"font-bold text-center "+(e.analyzer?"":"text-gray-400"),children:[(0,o.jsx)("p",{ref:n,className:"text-6xl",children:"--"}),(0,o.jsx)("p",{ref:r,className:"text-sl",children:"-- Hz"})]})},d=function(){var e=(0,t.useState)(!1),n=(0,a.Z)(e,2),r=n[0],s=n[1],u=(0,t.useState)(),f=(0,a.Z)(u,2),d=f[0],h=f[1];function m(){var e,n;null===d||void 0===d||null===(e=d.analyzer)||void 0===e||e.disconnect(),null===d||void 0===d||null===(n=d.stream)||void 0===n||n.getTracks().forEach((function(e){return e.stop()})),h({stream:void 0,analyzer:void 0})}return(0,l.y1)("Space",(function(){return s((function(e){return!e}))})),(0,t.useEffect)((function(){if(r)return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){var n=new window.AudioContext,r=new AnalyserNode(n,{});n.createMediaStreamSource(e).connect(r),h({stream:e,analyzer:r})})),m;m()}),[r]),(0,o.jsxs)("div",{className:"m-auto flex flex-col center items-center",children:[(0,o.jsx)("button",{id:"btn-play",className:"text-6xl "+(r?"":"text-gray-400")+" hover:text-cyan-500",onMouseDown:function(){return s((function(e){return!e}))},children:r?(0,o.jsx)(i.C4C,{}):(0,o.jsx)(i.OnQ,{})}),(0,o.jsx)(c,{analyzer:null===d||void 0===d?void 0:d.analyzer,samplingStep:10}),(0,o.jsx)(v,{analyzer:null===d||void 0===d?void 0:d.analyzer}),(0,o.jsx)("article",{className:"prose",children:(0,o.jsx)("ul",{children:(0,o.jsxs)("li",{children:["Press ",(0,o.jsx)("kbd",{children:"Space"})," to toggle pitch detection via microphone."]})})})]})}}}]);
//# sourceMappingURL=833.b122c2d2.chunk.js.map